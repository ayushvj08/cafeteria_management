<section class=container>
<h4 class="CartHeading"> Shopping Cart </h4>
<div style="text-align:center;">
        <table class="table table-striped table-hover">
        <thead>
        <th><p>Item</p></th>
        <th><p>Qty</p></th>
        <th><p>Price</p></th>
        </thead>

        <% # Grouping cart items in a hash %>
        <% cart_items = @cart_items.all.map.group_by { |model| model = model.menu_item_name } %>
        <% total = 0 %>
        <% cart_items.each do |cart_item| %>
        <% total = total + @cart_items.where(menu_item_name: cart_item.last.first.menu_item_name).count * cart_item.last.first.menu_item_price %>
        
        <tbody>
        <tr>
            <td><p><%= cart_item.last.first.menu_item_name %> </p></td>

            <% if cart_items.include? cart_item.last.first.menu_item_name %>
            <td>
            <div style="display:flex;align-items:center;justify-content:center;">
                <%= button_to "+", { :controller => "shopping_cart", :action => "create", :menu_category_name => cart_item.last.first.menu_category_name,
                                     :menu_item_id => cart_item.last.first.menu_item_id, :menu_item_name => cart_item.last.first.menu_item_name,
                                     :menu_item_price => cart_item.last.first.menu_item_price }, class: "btn plus-minus btn-success", style: "color: #fff;" %>

                <% # Group & count %>

                <p class="shoppingCart-Item" style="padding:0 0.8rem;"> <%= @cart_items.where(menu_item_name: cart_item.last.first.menu_item_name).count %> </p>                
                <%= button_to "-", { :controller => "shopping_cart", :action => "destroy", :id => cart_item.last.first.id, :menu_category_name => cart_item.last.first.menu_category_name,
                                     :menu_item_id => cart_item.last.first.menu_item_id, :menu_item_name => cart_item.last.first.menu_item_name,
                                     :menu_item_price => cart_item.last.first.menu_item_price }, class: "btn plus-minus btn-success", style: "color: #fff;" %>
                
              </div>
              </td>

              <td><p class="shoppingCart-Item"> ₹ <%= @cart_items.where(menu_item_name: cart_item.last.first.menu_item_name).count * cart_item.last.first.menu_item_price %> </p></td>

            <% else %>
            
            <td><p> <%= @cart_items.where(menu_item_name: cart_item.last.first.menu_item_name).count %> </p></td>
            <td><p> ₹ <%= @cart_items.where(menu_item_name: cart_item.last.first.menu_item_name).count * cart_item.last.first.menu_item_price %> </p></td>
            </tr>
            <% end %>
            
        <% end %>
        <hr>
        <tr>
        <td> <p class="Total">Total</p></td>
        <td></td>
        <td><p> ₹ <%= total %> </p></td>
        </tr>
        </tbody>
        </table>
</div>
        <div style="text-align:center;">
          <%= link_to "Checkout", cafe_checkout_path, class: "btn btn-success", style: "color:#fff;" %>
        </div>
        <br/>
            <%= link_to "Back", cafe_path, class: "btn btn-success btn-sm", style: "color:#fff;" %>
        
</section>
<br/>